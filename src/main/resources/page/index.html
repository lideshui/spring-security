<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <title>首页</title>
    <link rel="stylesheet" type="text/css" href="/css/index.css" />
    <link rel="stylesheet" type="text/css" href="/css/component.css" />
    <div th:include="common/head :: head"></div>
</head>

<body>
<div id="vue">
    <el-container class="layout-container">
        <el-aside class="left-aside">
            <el-header class="left-header">
                登录成功
            </el-header>
            <el-menu class="left-menu" :default-openeds="openedList" @select="handleSelect" :unique-opened="true">
                <el-menu-item index="1">
                    <i class="el-icon-s-data"></i><span slot="title">首页</span>
                </el-menu-item>
            </el-menu>
        </el-aside>

        <el-container>
            <el-header class="top-header">
                <span>已登录</span>
                <el-dropdown>
                    <i class="el-icon-setting" style="margin-left: 15px; color: #e4e3e3"></i>
                    <el-dropdown-menu slot="dropdown">
                        <el-dropdown-item><span @click="logout">退出</span></el-dropdown-item>
                    </el-dropdown-menu>
                </el-dropdown>
            </el-header>
            <el-main class="main-container">
            </el-main>
        </el-container>
    </el-container>
</div>

<!-- 创建当前页Vue对象 -->
<script th:inline="javascript">
    let item = new Vue({
        el: '#vue',
        data: {
            currentComponent: 'data-overview', // 当前显示的组件名称
            propsData: {}, // 子组件传参
            openedList: [], // 初始展开的菜单索引
            componentMap: {
            }
        },
        methods: {
            // 菜单事件
            handleSelect(index) {
                // 更新当前组件
                this.currentComponent = this.componentMap[index] || 'data-overview';
                // 更新展开的菜单状态
                if (index.includes('-')) {
                    const parentIndex = index.split('-')[0];
                    // 如果父级菜单不在展开列表中则添加
                    this.openedList = []; // 清空所有已展开的菜单
                    this.openedList.push(parentIndex); // 只展开当前父级菜单
                } else {
                    // 如果是顶级菜单，直接设置展开状态
                    this.openedList = [index];
                }
            },
            // 接子组件传参
            handleComponentChange(paramData) {
                this.currentComponent = paramData.component
                this.propsData = paramData.data
                console.log("params=", this.propsData)
            },
            // 退出登录
            logout(){
                // 删除cookie
                document.cookie = 'token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                // 删除localStorage
                localStorage.removeItem("user")
                // 重定向到登录页面
                window.location.href = '/login';
            },
        },
    })
</script>

</body>

</html>
